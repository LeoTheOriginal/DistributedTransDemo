<Window x:Class="TransDemo.UI.Views.SettingsView"
       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
       xmlns:vm="clr-namespace:TransDemo.UI.ViewModels"
       xmlns:beh="clr-namespace:TransDemo.UI.Behaviors"
       xmlns:conv="clr-namespace:TransDemo.UI.Converters"
       Title="Ustawienia Połączeń"
       Height="525" Width="700"
       WindowStartupLocation="CenterOwner">

   <Window.Resources>
       <conv:NullToBoolConverter x:Key="NullToBool"/>
   </Window.Resources>

   <!-- Updated DataContext to avoid XDG0003 -->
   <Window.DataContext>
        <vm:SettingsViewModel  />
    </Window.DataContext>

   <Grid Margin="10">
       <TabControl>
           <TabItem Header="Connections">
               <DockPanel>
                   <Grid DockPanel.Dock="Top" Margin="0,0,0,10" Height="42">
                       <Grid.ColumnDefinitions>
                           <ColumnDefinition Width="*"/>
                           <ColumnDefinition Width="Auto"/>
                           <ColumnDefinition Width="*"/>
                       </Grid.ColumnDefinitions>
                       <Button Grid.Column="1"
                               Content="Add"
                               Command="{Binding AddConnectionCommand}"
                               Width="100"/>
                   </Grid>
                   <ScrollViewer>
                       <ItemsControl ItemsSource="{Binding Connections}">
                           <ItemsControl.ItemTemplate>
                               <DataTemplate>
                                   <GroupBox Header="{Binding Key}" Margin="0,5">
                                       <Grid Margin="5">
                                           <Grid.ColumnDefinitions>
                                               <ColumnDefinition Width="Auto" />
                                               <ColumnDefinition Width="*" />
                                               <ColumnDefinition Width="Auto" />
                                               <ColumnDefinition Width="Auto"/>
                                           </Grid.ColumnDefinitions>
                                           <Grid.RowDefinitions>
                                               <RowDefinition Height="Auto" />
                                               <RowDefinition Height="Auto" />
                                               <RowDefinition Height="Auto" />
                                               <RowDefinition Height="Auto" />
                                               <RowDefinition Height="Auto" />
                                               <RowDefinition Height="Auto" />
                                               <RowDefinition Height="Auto" />
                                               <RowDefinition Height="Auto" />
                                           </Grid.RowDefinitions>

                                           <TextBlock Text="Server:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center"/>
                                           <TextBox Text="{Binding Server, UpdateSourceTrigger=PropertyChanged}"
                                                    Grid.Row="0" Grid.Column="1"/>
                                           <Button Content="Test"
                                                   Command="{Binding DataContext.TestConnectionCommand,
                                                             RelativeSource={RelativeSource AncestorType=Window}}"
                                                   CommandParameter="{Binding}"
                                                   Grid.Row="0" Grid.Column="2" Margin="5,0"/>
                                           <Button Content="Remove"
                                                   Command="{Binding DataContext.RemoveConnectionCommand,
                                                             RelativeSource={RelativeSource AncestorType=Window}}"
                                                   CommandParameter="{Binding}"
                                                   Grid.Row="0" Grid.Column="3" Margin="5,0"/>

                                           <TextBlock Text="Database:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center"/>
                                           <ComboBox ItemsSource="{Binding DataContext.AvailableDatabases, RelativeSource={RelativeSource AncestorType=Window}}"
                                                     SelectedItem="{Binding Database, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                     Grid.Row="1" Grid.Column="1"/>

                                           <TextBlock Text="User:" Grid.Row="2" Grid.Column="0" VerticalAlignment="Center"/>
                                           <TextBox Text="{Binding UserName}"
                                                    Grid.Row="2" Grid.Column="1"/>
                                           <TextBlock Text="Password:" Grid.Row="3" Grid.Column="0" VerticalAlignment="Center"/>
                                           <PasswordBox
                                               Grid.Row="3" Grid.Column="1"
                                               beh:PasswordBoxHelper.BindPassword="True"
                                               beh:PasswordBoxHelper.BoundPassword="{Binding Password, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                           <CheckBox Content="Remember Password"
                                                     IsChecked="{Binding RememberPassword}"
                                                     Grid.Row="4" Grid.Column="1"/>
                                           <CheckBox Content="Keep Connection Alive"
                                                     IsChecked="{Binding KeepConnectionAlive}"
                                                     Grid.Row="5" Grid.Column="1"/>
                                           <CheckBox Content="Encrypt"
                                                     IsChecked="{Binding Encrypt}"
                                                     Grid.Row="6" Grid.Column="1"/>
                                           <CheckBox Content="Trust Server Cert."
                                                     IsChecked="{Binding TrustServerCertificate}"
                                                     Grid.Row="7" Grid.Column="1"/>
                                       </Grid>
                                   </GroupBox>
                               </DataTemplate>
                           </ItemsControl.ItemTemplate>
                       </ItemsControl>
                   </ScrollViewer>
               </DockPanel>
           </TabItem>
       </TabControl>

       <StackPanel Orientation="Horizontal"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Margin="0,10,0,0">
           <Button Content="Apply"
                   Command="{Binding ApplyCommand}"
                   Width="75" Margin="5"/>
           <Button Content="Cancel"
                   Command="{Binding CancelCommand}"
                   CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                   Width="75"/>
       </StackPanel>
   </Grid>
</Window>
